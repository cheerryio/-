<!DOCTYPE html>

<head>
    <title></title>
    <meta charset="utf-8">
</head>

<body>
    <script>
        function indexedDB_addinfo(data) {
            let request = window.indexedDB.open("animeimages", 1);
            request.onupgradeneeded = (ev) => {
                let db = ev.target.result;
                if (!db.objectStoreNames.contains("images")) {
                    let objectStore = db.createObjectStore("images", {
                        keyPath: "image_name"
                    });
                }
            }

            request.onsuccess = (ev) => {
                let db = ev.target.result;
                let transaction = db.transaction(["images"], 'readwrite');

                transaction.oncomplete = function(event) {
                    console.log('事务完成');
                };
                transaction.onerror = function(event) {
                    console.log('事务错误信息: ' + transaction.error);
                };

                let objectStore = transaction.objectStore("images");
                let objectStoreRequest = objectStore.add(data);

                objectStoreRequest.onsuccess = function(event) {
                    console.log('数据添加成功');
                };
            }
        }

        function fetchStoreByCursor() {

            let request = window.indexedDB.open("animeimages", 1);
            request.onupgradeneeded = (ev) => {
                let db = ev.target.result;
                if (!db.objectStoreNames.contains("images")) {
                    let objectStore = db.createObjectStore("images", {
                        keyPath: "image_name"
                    });
                }
            }

            request.onsuccess = (ev) => {
                let db = ev.target.result;
                var transaction = db.transaction("images");

                transaction.oncomplete = function(event) {
                    console.log('事务完成');
                }
                transaction.onerror = function(event) {
                    console.log('事务错误信息: ' + transaction.error);
                }

                var objectStore = transaction.objectStore("images");
                var request = objectStore.openCursor();
                request.onsuccess = function(e) {
                    var cursor = e.target.result;
                    if (cursor) {
                        var current = cursor.value;
                        console.log(current.image_name);
                        cursor.continue();
                    }
                }
            }
        }
        fetchStoreByCursor();
    </script>
</body>

</html>
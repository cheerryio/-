<!DOCTYPE html>

<head>
    <title></title>
    <meta charset="utf-8">
</head>

<body>
    <button id="here">click</button>
    <script>
        window.db = null;

        function indexedDB_create() {

            let request = window.indexedDB.open("antzone", 4);
            request.onupgradeneeded = (ev) => {
                let db = ev.target.result;
                if (!db.objectStoreNames.contains('website')) { //为何test2无法创建objectStore？
                    console.log("aa");
                    let objectStore = db.createObjectStore('website', {
                        keyPath: 'email'
                    });
                }
            }

            request.onsuccess = (e) => {
                db = e.target.result;
                console.log("create db success");
            }
            request.onerror = (e) => {
                console.log("ERROR:", e);
            }
            window.db = db;
        }


        function indexedDB_addinfo(data) {
            console.log(window.db);
            var transaction = window.db.transaction(["website"], "readwrite");

            transaction.oncomplete = function(e) {
                console.log("transaction success");
            }

            transaction.onerror = function(e) {
                console.log("ERROR:" + transaction.console.error);
            }

            let objectStore = transaction.objectStore("website");
            let objectStoreRequest = objectStore.add(data);

            objectStoreRequest.onsuccess = function(e) {
                console.log("addinfo success");
            }

        }
        indexedDB_create();
        var here = document.getElementById("here");
        here.onclick = function() {
            indexedDB_addinfo({
                "email": "aassss"
            })
        }
    </script>
</body>

</html>